# Unity Scene & UI Manager

Этот проект демонстрирует, как организовать управление сценами и пользовательским интерфейсом в Unity с помощью нескольких скриптов. Ниже приведено описание основных скриптов, входящих в проект.

---

## Скрипты

### MainSceneUIManager

**MainSceneUIManager** отвечает за управление пользовательским интерфейсом на главной сцене и включает в себя следующие функции:

- **Переключение между меню:**  
  Используется перечисление `MenuState` с двумя состояниями — `MainMenu` (главное меню) и `Settings` (настройки). Метод `ChangeStateMenu()` переключает отображение между соответствующими UI-элементами (`_mainMenuUI` и `_settingsMenuUI`).

- **Переход к сцене чата:**  
  При нажатии на кнопку `_openChatButton` вызывается метод `ChatScene()`, который с помощью объекта `_loader` асинхронно загружает сцену чата.

- **Настройка и отображение цветов:**  
  Скрипт позволяет пользователю настраивать цвета для двух элементов — для "user" и для "bot".  
  - Изменения значений слайдеров (`_userRed`, `_userGreen`, `_userBlue` и `_botRed`, `_botGreen`, `_botBlue`) обновляют соответствующие цвета в реальном времени через метод `ChangeColorRealTimeUI()`.
  - Текст кнопки сохранения меняется в зависимости от того, отличаются ли текущие значения от сохранённых.

- **Сохранение и загрузка настроек цвета:**  
  - Метод `SaveUIColor()` сохраняет текущие значения цветов в `PlayerPrefs`, что позволяет сохранять настройки между сессиями.
  - При запуске (`Awake()`) происходит проверка: если сохранённых значений нет (или они равны нулю), вызывается метод `DefaultUIColor()`, который устанавливает стандартные значения; иначе — загружаются сохранённые настройки с помощью `SetColorsFromSave()`.

---

### SceneLoader

Скрипт **SceneLoader** предоставляет удобный механизм для загрузки сцен как синхронно, так и асинхронно. Основные возможности:

- **Синхронная загрузка:**  
  Метод `LoadScene(SceneData.SceneType sceneType)` получает имя сцены через объект `SceneData` и использует `SceneManager.LoadScene(sceneName)` для мгновенной загрузки. Если сцена не найдена, выводится сообщение об ошибке.

- **Асинхронная загрузка:**  
  Метод `LoadSceneAsync(SceneData.SceneType sceneType)` также получает имя сцены и запускает Coroutine `LoadSceneAsyncCoroutine(sceneName)`.  
  - В Coroutine происходит асинхронная загрузка через `SceneManager.LoadSceneAsync(sceneName)`.
  - Прогресс загрузки нормализуется (учитывая, что `operation.progress` идёт от 0 до 0.9) и выводится в консоль.  
  - Здесь же можно интегрировать обновление UI (например, индикатора загрузки).

---

### SceneData

**SceneData** — это ScriptableObject, предназначенный для управления информацией о сценах проекта:

- **Перечисление SceneType:**  
  Определяет логические имена для сцен, например, `MainMenu` и `Chat`, что упрощает ссылку на сцены по смысловым именам, а не строковым значениям.

- **Структура SceneMapping:**  
  Содержит два поля:
  - `sceneType` — тип сцены из перечисления.
  - `scene` — объект типа `SceneAsset`, соответствующий сцене, как она указана в Build Settings.

- **Массив scenes:**  
  Позволяет хранить список всех сопоставлений между типами сцен и их ассетами.

- **Метод GetScene:**  
  Принимает тип сцены и перебирает массив `scenes` для поиска соответствующего `SceneAsset`. Если нужное сопоставление не найдено, возвращается первая сцена из массива.

- **Атрибут CreateAssetMenu:**  
  Позволяет создать новый объект `SceneData` через контекстное меню Unity (путь: *ScriptableObjects/SceneData*).

---

## Как использовать

1. **Создание объекта SceneData:**  
   Через меню Unity (Create → ScriptableObjects → SceneData) создайте объект, который будет хранить информацию о сценах. Добавьте в него нужные сцены, сопоставив их с логическими именами.

2. **Настройка инспектора:**  
   Привяжите созданный объект `SceneData` к соответствующим полям в инспекторе для скриптов `SceneLoader` и `MainSceneUIManager`.

3. **Настройка UI:**  
   Настройте кнопки, слайдеры и другие элементы интерфейса в Unity Editor, связав их с методами из `MainSceneUIManager` и `SceneLoader`.

4. **Запуск проекта:**  
   При запуске проекта вы сможете переключаться между основным меню и меню настроек, настраивать цвета элементов, сохранять эти настройки и переходить к другим сценам (например, к сцене чата).

---
# ConversationExample (Hugging Face API Integration)

## Описание  
`ConversationExample` — это скрипт для Unity, который позволяет взаимодействовать с API Hugging Face для обработки текстовых запросов в формате чата. Пользователь может вводить текст, отправлять его на обработку и получать ответы от ИИ в диалоговом окне.  

## Функциональность  
- **Отправка сообщений** — пользователь вводит текст и отправляет его в API Hugging Face.  
- **Вывод ответов** — полученный ответ отображается в текстовом поле чата.  
- **Цветовое оформление сообщений** — сообщения пользователя и бота имеют разные цвета, которые можно настроить через `PlayerPrefs`.  
- **Очистка чата** — кнопка для очистки истории сообщений.  
- **Возврат в главное меню** — кнопка для асинхронной загрузки главного меню.  

## Используемые компоненты  
- `ScrollRect` — для прокрутки чата.  
- `TMP_Text` — для отображения истории переписки.  
- `TMP_InputField` — поле ввода для пользователя.  
- `Button` — кнопки для отправки сообщений, очистки чата и возврата в главное меню.  
- `SceneLoader` — используется для загрузки сцен.  

## Как использовать  
1. Добавить `ConversationExample` на объект в сцене.  
2. Назначить ссылки на UI-элементы (`ScrollRect`, `TMP_Text`, `TMP_InputField`, `Button`).  
3. В `PlayerPrefs` можно задать цвета сообщений пользователя и бота (`userR`, `userG`, `userB`, `botR`, `botG`, `botB`).  
4. Убедиться, что `SceneLoader` настроен для загрузки сцен.  
5. Запустить сцену и протестировать работу чата.  

## API  
Используется метод `HuggingFaceAPI.Conversation()`, который отправляет запрос в API и получает ответ.  
- В случае успешного ответа текст добавляется в чат.  
- В случае ошибки выводится сообщение об ошибке.  

## Дополнительно  
- `SendQuery()` — метод для отправки запроса.  
- `OnInputFieldEndEdit()` — обработчик нажатия `Enter` для отправки сообщения.  
- `ClearButtonClicked()` — очищает чат.  
- `ToMainMenu()` — загружает главное меню.  

---

# Трудности при разработке

При отправке запроса возникала следующая ошибка:

```
Error: Attempted all backup endpoints, last error: HTTP/1.1 400 Bad Request - {"error":" args[0]: {'past_user_inputs': [], 'generated_responses': [], 'text': 'Hello'} have the wrong format. They should be either of type str or type list","warnings":["There was an inference error:  args[0]: {'past_user_inputs': [], 'generated_responses': [], 'text': 'Hello'} have the wrong format. They should be either of type str or type list"]}
```

Исправление этой ошибки не было задокументировано, и на форумах также не нашлось обсуждений по данной проблеме.

### Решение

Решение удалось найти, переписав код в файле:

```
Package/HuggingFaceApi/Runtime/Implementations/Tasks/ConversationTask.cs
```

Оригинальное обсуждение и источник решения можно найти здесь: [GitHub Issue #28](https://github.com/huggingface/unity-api/issues/28).

